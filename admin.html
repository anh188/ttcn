<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý thông tin hoa</title>
    <link rel="stylesheet" href="./css/admin.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  </head>
<body>
  <div class="management">
    <div class="management_lf c-7">
      <div class="profile">
        <img class="profile-ava" src="./asset/images.jpg" alt="">
        <h1 class="nameuser"></h1>
        <nav>
          <a href="">Quản lý user</a>
          <a href="">Quản lý hoa</a>
          <a href="">Quản lý Bộ</a>
          <a href="">Quản lý Chi</a>
          <a href="">Quản lý Họ</a>
          <a href="">Quản lý Hình dạng</a>
          <a href="">Quản lý Bề mặt</a>
          <a href="">Quản lý Loại độ khẩu</a>
          <a href="">Quản lý Phần</a>
        </nav>
      </div>
    </div>
    <div class="management_rg c-3">
      <div >
        <h1>Quản lý thông tin hoa</h1>
        <div id="notification">Xóa dữ liệu thành công</div>
        <div class="container mb-4">
          <input type="text" id="searchInput" class="form-control" placeholder="Tìm kiếm theo tên hoa hoặc tên khoa học...">
          <button id="addFlowerBtn"><i class="fa-solid fa-square-plus"></i> Add New</button>
        </div>
      </div>

      <table id="flowerTable" class="table table-hover">
        <thead>
          <tr>
            <th>Ảnh hoa</th>
            <th>Tên hoa</th>
            <th>Tên khoa học</th>
            <th>Kích thước</th>
            <th>Bộ</th>
            <th>Họ</th>
            <th>Chi</th>
            <th>Phần</th>
            <th>Loại độ khẩu</th>
            <th>Ảnh hạt phấn</th>
            <th>Thời gian update</th>
            <th>Tính năng</th>
          </tr>
          </thead>
          <tbody id="tableRows">
            <!-- Các hàng dữ liệu sẽ được thêm vào đây bằng JavaScript -->
          </tbody>
      </table>

      <nav aria-label="Page navigation">
        <ul class="pagination" id="pagination">
          <!-- Pagination buttons will be generated here -->
        </ul>
      </nav>
    </div>

    </div>

    <div class="modal_creatfl modal_cr">
      <div class="modal-container js-modal-container">
          <div class="modal-close-add js-modal-close-add">
              <i class="fa-solid fa-xmark"></i>
          </div>
          <header class="modal-header">
              <h2>Thêm hoa mới</h2>
          </header>
  
          <div class="modal_creatfl_body">
              <div class="p-2">
                  <label class="modal-input p-1" for="common-name">Tên thường gọi</label>
                  <input type="text" class="modal-input" id="common-name" placeholder="Nhập tên thường gọi">
              </div>
  
              <div class="p-2">
                  <label class="modal-input p-1" for="scientific-name">Tên khoa học</label>
                  <input type="text" class="modal-input" id="scientific-name" placeholder="Nhập tên khoa học">
              </div>
  
              <div class="p-2">
                <div class="d-flex">
                  <label class="modal-input p-1" for="pollen-size">Kích thước hạt phấn</label>
                  <button id="add-micron">µm</button>
                </div>
                <input type="text" class="modal-input" id="pollen-size" placeholder="Nhập kích thước hạt phấn">
            </div>
  
              <div class="p-2">
                  <label class="modal-input p-1" for="order">Bộ</label>
                  <input type="text" class="modal-input" id="order" placeholder="Nhập bộ" oninput="fetchSuggestions('sets', 'order')">
                  <div id="order-suggestions" class="suggestions"></div>
              </div>
  
              <div class="p-2">
                  <label class="modal-input p-1" for="family">Họ</label>
                  <input type="text" class="modal-input" id="family" placeholder="Nhập họ" oninput="fetchSuggestions('surnames', 'family')">
                  <div id="family-suggestions" class="suggestions"></div>
              </div>
  
              <div class="p-2">
                  <label class="modal-input p-1" for="genus">Chi</label>
                  <input type="text" class="modal-input" id="genus" placeholder="Nhập chi" oninput="fetchSuggestions('genuss', 'genus')">
                  <div id="genus-suggestions" class="suggestions"></div>
              </div>
  
              <div class="p-2">
                  <label class="modal-input p-1" for="pollen-shape">Hình dạng phấn hoa</label>
                  <input type="text" class="modal-input" id="pollen-shape" placeholder="Nhập hình dạng phấn hoa" oninput="fetchSuggestions('shapes', 'pollen-shape')">
                  <div id="pollen-shape-suggestions" class="suggestions"></div>
              </div>
  
              <div class="p-2">
                  <label class="modal-input p-1" for="pollen-surface">Bề mặt phần hoa</label>
                  <input type="text" class="modal-input" id="pollen-surface" placeholder="Nhập bề mặt phần hoa" oninput="fetchSuggestions('surfaces', 'pollen-surface')">
                  <div id="pollen-surface-suggestions" class="suggestions"></div>
              </div>
  
              <div class="p-2">
                  <label class="modal-input p-1" for="part">Phần</label>
                  <input type="text" class="modal-input" id="part" placeholder="Nhập phần" oninput="fetchSuggestions('parts', 'part')">
                  <div id="part-suggestions" class="suggestions"></div>
              </div>
  
              <div class="p-2">
                  <label class="modal-input p-1" for="aperture-type">Loại độ khẩu</label>
                  <input type="text" class="modal-input" id="aperture-type" placeholder="Nhập loại độ khẩu" oninput="fetchSuggestions('apertures', 'aperture-type')">
                  <div id="aperture-type-suggestions" class="suggestions"></div>
              </div>
  
              <div class="p-2">
                  <label class="modal-input p-1" for="flower-image">Ảnh hoa</label>
                  <input type="file" class="modal-input" id="flower-image" placeholder="Chọn ảnh hoa" multiple>
                  <div id="flower-image-preview"></div>
              </div>
  
              <div class="p-2">
                  <label class="modal-input p-1" for="pollen-image">Ảnh hạt phấn</label>
                  <input type="file" class="modal-input" id="pollen-image" placeholder="Chọn ảnh hạt phấn" multiple>
                  <div id="pollen-image-preview"></div>
              </div>
  
              <div>
                  <button class="btn_save_cr_flower">Lưu</button>
                  <button class="btn_exit_cr_flower">Thoát</button>
              </div>
          </div>
      </div>
  </div>

<script src="./js/ad_delete_fl.js"></script>
<script src="./js/ad_creat_fl.js"></script>
<script src="./js/ad_modal_cr_fl.js"></script>
<script src="./js/ad_showdt_fl.js"></script>
<script>

let timeoutId; // Biến để lưu ID của timer

function fetchSuggestions(type, elementId) {
    return new Promise((resolve, reject) => {
        const inputElement = document.getElementById(elementId);
        const suggestionsContainer = document.getElementById(`${elementId}-suggestions`);

        
        inputElement.addEventListener('input', function() {
            const query = inputElement.value.trim();

            // Xóa timer cũ trước khi tạo một timer mới
            clearTimeout(timeoutId);

            // Thiết lập timer mới để gửi yêu cầu sau một khoảng thời gian nhất định
            timeoutId = setTimeout(() => {
                if (query.length === 0) {
                    suggestionsContainer.innerHTML = '';
                    return;
                }

                const apiUrl = `http://localhost:3456/${type}/?page=1&per_page=5&field=name&sort_order=asc&q=${encodeURIComponent(query)}`;

                fetch(apiUrl)
                    .then(response => response.json())
                    .then(res => {
                        const data = res.data[type] || res.data.genuss || [];

                        if (data && Array.isArray(data)) {
                            suggestionsContainer.innerHTML = data.map(item => `
                                <div class="suggestion-item" data-id="${item._id}" data-name="${item.name}">
                                    ${item.name}
                                </div>
                            `).join('');
                        } else {
                            suggestionsContainer.innerHTML = '<div class="suggestion-item">No results found</div>';
                        }
                        resolve();
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                        suggestionsContainer.innerHTML = '<div class="suggestion-item">Error fetching data</div>';
                        reject(error);
                    });
            }, 300); // Thời gian chờ trước khi gửi yêu cầu (500ms)
        });

        suggestionsContainer.addEventListener('click', function(event) {
    const item = event.target.closest('.suggestion-item');
    if (item) {
        const id = item.getAttribute('data-id');
        const name = item.getAttribute('data-name');
        inputElement.value = name;
        // Set giá trị ID vào một thuộc tính khác của input, ví dụ 'data-id'
        inputElement.setAttribute('data-id', id); 
        suggestionsContainer.innerHTML = '';
    }
});

        document.addEventListener('click', function(event) {
            if (!suggestionsContainer.contains(event.target) && event.target !== inputElement) {
                suggestionsContainer.innerHTML = '';
            }
        });
    });
}

function getIdFromInput(type, elementId) {
    const inputElement = document.getElementById(elementId);
    if (!inputElement) {
        console.error(`Input element with id ${elementId} not found.`);
        return '';
    }

    // Lấy giá trị ID từ thuộc tính 'data-id' của ô nhập liệu
    const id = inputElement.getAttribute('data-id'); 
    if (!id) {
        console.error(`No suggestion ID found for element ${elementId}.`);
        return '';
    }

    return id;
}
  </script>

<style>
.suggestions {
    border: 1px solid #ccc;
    max-height: 150px;
    overflow-y: auto;
    background: white;
    position: absolute;
    z-index: 1;
}

.suggestion-item {
    padding: 8px;
    cursor: pointer;
    /* display: flex; */
}

.suggestion-item:hover {
    background: #f0f0f0;
}
</style>
<style>
  .suggestions-container {
    position: absolute;
    background: white;
    border: 1px solid #ccc;
    max-height: 150px;
    overflow-y: auto;
    z-index: 1000;
}

.suggestion-item {
    padding: 8px;
    cursor: pointer;
}

.suggestion-item:hover {
    background-color: #f0f0f0;
}
  </style>
</body>
</html>