<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/home.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/search.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
  <header class="header">
    <nav class="navbar">
      <a href="home.html">Trang chủ</a>
      <a href="contact.html">Giới thiệu</a>
      <a href="contact.html">Liên hệ</a>
      <!-- <a href="#">Contact</a> -->
    </nav>
      <a class="link-login" href="loginregister.html">Đăng nhập</a>
  </header>
 
    <!-- <div class="filter-container">
      <label for="bo-filter">Bộ:</label>
      <select id="bo-filter">
        <option value=""></option>
      </select>
    
      <label for="ho-filter">Họ:</label>
      <select id="ho-filter">
        <option value=""></option>
      </select>
    
      <label for="kich-thuoc-filter">Kích thước:</label>
      <select id="kich-thuoc-filter">
        <option value=""> </option>
      </select>
    </div> -->
    <div id="content container">
      <div class="Thucvat">
        <h1>Thư Viện Hoa</h1> 
        <div class="search">
          <div class="search-container">
            <input type="text" id="searchInput" placeholder="Tìm kiếm...">
            <button type="button" id="searchButton"><i class='bx bx-search'></i></button>
          </div>  
        </div>
        <div class="container" id="gallery">
          <!-- Các cây sẽ được thêm vào đây -->
        </div>
        <p id="resultCount">Số kết quả hiển thị: 0</p>
      </div>
    </div>
  
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const galleryContainer = document.getElementById('gallery');
        const resultCount = document.getElementById('resultCount');
  
        function fetchAndDisplayFlowers(query = '') {
          let apiUrl = 'http://localhost:3456/flowers/?page=1&per_page=100&field=name&sort_order=asc';
          if (query) {
            apiUrl += `&q=${encodeURIComponent(query)}`;
          }
  
          fetch(apiUrl)
            .then(response => {
              if (!response.ok) {
                throw new Error('Network response was not ok');
              }
              return response.json();
            })
            .then(data => {
              const flowers = data.data.flowers;
              galleryContainer.innerHTML = ''; // Xóa thư viện hiện tại
              let visibleCount = 0;
  
              if (flowers.length === 0) {
                galleryContainer.innerHTML = '<p>Không tìm thấy kết quả nào.</p>';
                resultCount.textContent = 'Số kết quả hiển thị: 0';
                return;
              }
  
              // Tạo phần tử cho mỗi cây và thêm vào galleryContainer
              flowers.forEach(flower => {
                const div = document.createElement('div');
                div.classList.add('gallery-item');
                const a = document.createElement('a');
                a.href = './details.html';
                a.setAttribute('data-bo', flower.set_id.name);
                a.setAttribute('data-ho', flower.surname_id.name);
                a.setAttribute('data-kich-thuoc', flower.size);
  
                const img = document.createElement('img');
                img.src = flower.flower_images[0] || './asset/IMG_5148.JPG'; // Sử dụng hình ảnh mặc định nếu không có hình ảnh
                // img.alt = flower.name;
  
                const h3 = document.createElement('h3');
                h3.textContent = flower.name;
  
                a.appendChild(img);
                a.appendChild(h3);
                div.appendChild(a);
                galleryContainer.appendChild(div);
                visibleCount++;
              });
  
              resultCount.textContent = `Số kết quả hiển thị: ${visibleCount}`;
            })
            .catch(error => {
              console.error('Lỗi khi lấy dữ liệu:', error);
              galleryContainer.innerHTML = '<p>Đã xảy ra lỗi khi tải dữ liệu.</p>';
              resultCount.textContent = 'Số kết quả hiển thị: 0';
            });
        }
  
        function handleSearch() {
          const searchTerm = searchInput.value.trim();
          if (searchTerm !== '') {
            sessionStorage.setItem('searchTerm', searchTerm);
            fetchAndDisplayFlowers(searchTerm);
          }
        }
  
        searchInput.addEventListener('keypress', function (event) {
          if (event.key === 'Enter') {
            handleSearch();
          }
        });
  
        searchButton.addEventListener('click', function () {
          handleSearch();
        });
  
        searchInput.addEventListener('input', function () {
          const searchTerm = this.value.trim();
          if (searchTerm === '') {
            fetchAndDisplayFlowers(); // Tải lại dữ liệu ban đầu khi ô tìm kiếm trống
          }
        });
  
        // Fetch initial data without search query
        fetchAndDisplayFlowers();
      });
    </script>
  </body>
  </html>